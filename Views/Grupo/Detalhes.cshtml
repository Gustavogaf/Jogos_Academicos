@model Jogos_Academicos.Models.Grupo

@{
    ViewData["Title"] = "Detalhes do Grupo";
}

<div class="container" style="padding: 20px;">
    <h2>@Model.Nome</h2>

    @if (TempData["Sucesso"] != null)
    {
        <div class="alert alert-success">@TempData["Sucesso"]</div>
    }
    @if (TempData["Erro"] != null)
    {
        <div class="alert alert-danger">@TempData["Erro"]</div>
    }

    <h3 style="margin-top: 20px;">Classificação</h3>

    @if (ViewBag.Classificacao != null)
    {
        <table class="table table-hover" style="margin-bottom: 30px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
            <thead style="background-color: #6d28d9; color: white;">
                <tr>
                    <th style="padding: 10px;">Pos</th>
                    <th style="padding: 10px; text-align: left;">Equipe</th>
                    <th style="padding: 10px; text-align: center;">PTS</th>
                    <th style="padding: 10px; text-align: center;">J</th>
                    <th style="padding: 10px; text-align: center;">V</th>
                    <th style="padding: 10px; text-align: center;">E</th>
                    <th style="padding: 10px; text-align: center;">D</th>
                    <th style="padding: 10px; text-align: center;">SG</th>
                </tr>
            </thead>
            <tbody>
                @{
                    int posicao = 1;
                }
                @foreach (var time in (IEnumerable<Jogos_Academicos.Models.ClassificacaoGrupo>)ViewBag.Classificacao)
                {
                    int jogosJogados = time.Vitorias + time.Empates + time.Derrotas;
                    <tr>
                        <td style="text-align: center; font-weight: bold;">@posicao</td>
                        <td>@time.Equipe.Nome</td>
                        <td style="text-align: center; font-weight: bold; color: #6d28d9;">@time.Pontos</td>
                        <td style="text-align: center;">@jogosJogados</td>
                        <td style="text-align: center;">@time.Vitorias</td>
                        <td style="text-align: center;">@time.Empates</td>
                        <td style="text-align: center;">@time.Derrotas</td>
                        <td style="text-align: center;">@time.SaldoGols</td>
                    </tr>
                    posicao++;
                }
            </tbody>
        </table>
    }
    else
    {
        <p class="text-muted">A classificação será gerada após o primeiro jogo.</p>
    }

    <hr />

    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h3>Equipes Participantes</h3>

        @if (User.IsInRole("Coordenador"))
        {
            <a asp-action="GerenciarEquipes" asp-route-grupoId="@Model.Id" class="btn btn-sm btn-outline-primary" style="border-color: #6d28d9; color: #6d28d9;">
                ⚙️ Gerenciar Equipes
            </a>
        }
    </div>

    @if (Model.Equipes != null && Model.Equipes.Any())
    {
        <ul>
            @foreach (var equipe in Model.Equipes)
            {
                <li>@equipe.Nome</li>
            }
        </ul>
    }
    else
    {
        <p class="text-muted">Nenhuma equipe adicionada a este grupo ainda.</p>
    }

    <hr />

    <h3>Tabela de Jogos</h3>

    @if (!Model.Jogos.Any())
    {
        <div class="alert alert-secondary">
            Nenhum jogo gerado ainda.
        </div>

        @if (User.IsInRole("Arbitro"))
        {
            <div class="alert alert-info">
                Para gerar a tabela de jogos deste evento, acesse o
                <a asp-controller="Evento" asp-action="PainelArbitro" class="alert-link">Painel de Gestão do Torneio</a>.
            </div>
        }
        else
        {
            <p class="text-muted">Aguardando o Árbitro gerar a tabela de jogos.</p>
        }
    }
    else
    {
        <table class="table table-bordered table-striped" style="margin-top: 10px;">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Time A</th>
                    <th class="text-center">Placar</th>
                    <th>Time B</th>
                    <th>Fase</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var jogo in Model.Jogos.OrderBy(j => j.DataHora))
                {
                    <tr>
                        <td>@jogo.DataHora.ToString("dd/MM/yyyy")</td>
                        <td class="text-end">@jogo.EquipeA.Nome</td>
                        <td class="text-center fw-bold">
                            @(jogo.Finalizado ? $"{jogo.PlacarA} x {jogo.PlacarB}" : "vs")
                            @if (jogo.WoA)
                            {
                                <span class="badge bg-danger">W.O.</span>
                            }
                            @if (jogo.WoB)
                            {
                                <span class="badge bg-danger">W.O.</span>
                            }
                        </td>
                        <td>@jogo.EquipeB.Nome</td>
                        <td>
                            @if (jogo.Fase == Jogos_Academicos.Models.Enums.FaseTorneio.Grupos)
                            {
                                <span class="badge bg-info text-dark">Fase de Grupos</span>
                            }
                            else
                            {
                                <span class="badge bg-warning text-dark">Mata-Mata</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }

    <div style="margin-top: 30px;">
        @if (User.IsInRole("Coordenador"))
        {
            <a asp-controller="Evento" asp-action="Index" class="btn btn-outline-secondary">← Voltar para Eventos</a>
        }
        else
        {
            <a asp-controller="Home" asp-action="Index" class="btn btn-outline-secondary">← Voltar para Início</a>
        }
    </div>
</div>